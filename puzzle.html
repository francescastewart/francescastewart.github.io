<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PuzzlePop</title>
        <script src="https://cdn.tailwindcss.com/"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
    </head>
    
    <style>
        .highlighted {
            background-color: #ffe58f !important; /* light yellow highlight */
        }
    </style>

    <script>
        addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById("easySudokuContainer");
            
            //*********************START OF PUZZLES*********************
            //https://sudoku-puzzles.net/sudoku-4x4-medium/ reference for sudoku
            const puzzle1 = [
                [0, 0, 0, 4],
                [0, 0, 0, 0],
                [2, 0, 0, 3],
                [4, 0, 1, 2]
            ];

            const solvedPuzzle1 = [
                [1, 2, 3, 4],
                [3, 4, 2, 1],
                [2, 1, 4, 3],
                [4, 3, 1, 2]
            ];

            const puzzle2 = [
                [0, 0, 0, 3],
                [0, 4, 0, 0],
                [1, 0, 0, 4],
                [0, 0, 3, 0]
            ];

            const solvedPuzzle2 = [
                [2, 1, 4, 3],
                [3, 4, 1, 2],
                [1, 3, 2, 4],
                [4, 2, 3, 1]
            ];
            
            //*********************END OF PUZZLES*********************
            const completePuzzle1 = {"puzzle":puzzle1, "solution":solvedPuzzle1}
            const completePuzzle2 = {"puzzle":puzzle2, "solution":solvedPuzzle2}
            const allPuzzles = [completePuzzle1, completePuzzle2]
            var random = Math.floor(Math.random() * 4); 
            var currPuzzle =puzzle2; //make random
            var currSolution = solvedPuzzle2; //make random
            var lastInteractedRow = 0;
            var lastInteractedCol = 0;

            //This function checks the current input and returns the user's input as a 2D array
            function getSudokuInput(){
                const inputs = container.querySelectorAll('input');
                var userPuzzle = [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ];
                inputs.forEach(input=>{
                    var row = parseInt(input.dataset.row);
                    var col = parseInt(input.dataset.col);
                    var ans = parseInt(input.value)||0;
                    userPuzzle[row][col]=ans;
                });
                return userPuzzle;
            }

            //This function checks the current input to see if it is the same as the solved input
            function checkPuzzle(){
                const feedbackDiv = document.getElementById("feedback");
                var userPuzzle = getSudokuInput();
                if(JSON.stringify(userPuzzle) == JSON.stringify(currSolution)){
                    feedbackDiv.value = "Congrats!"
                    feedbackDiv.classList.remove("text-rose-600");
                    feedbackDiv.classList.add("text-green-700");
                    const continueDiv = document.getElementById("clickContinue");
                    continueDiv.classList.remove("hidden")
                }
                else{
                    feedbackDiv.value = "Incorrect, keep trying!";
                }
                    
            }
            
            //This function clears the board but maintains the solved puzzle
            function resetPuzzle(){
                const inputs = container.querySelectorAll('input');
                inputs.forEach(input=>{
                    var row = parseInt(input.dataset.row);
                    var col = parseInt(input.dataset.col);
                    input.value = (currPuzzle[row][col] !== 0 ? currPuzzle[row][col] : '');
                });
            }

            function highlightCell(e) {
                // remove highlight from all cells
                container.querySelectorAll('.highlighted').forEach(c => c.classList.remove('highlighted'));

                // highlight the tapped cell
                e.currentTarget.classList.add('highlighted');
            }
            function createSudokuGrid(puzzle) {
                container.innerHTML = '';

                puzzle.forEach((row, rowIndex) => {
                    row.forEach((cell, columnIndex) => {
                    const cellElement = document.createElement('input');
                    cellElement.type = 'text';
                    cellElement.maxLength = 1;
                    cellElement.value = (cell !== 0 ? cell : ''); //if the cell is 0 then print blank
                    cellElement.readOnly = true; 
                    cellElement.setAttribute("inputmode", "none");
                    cellElement.className = `
                        sudokuCell w-12 h-12 text-center text-lg font-bold
                        border border-gray-200 box-border focus:border-black-700 active:border-black-700
                        ${(rowIndex + columnIndex) % 2 === 0 ? 'bg-white' : 'bg-gray-200'}
                    `;
                    if ((columnIndex + 1) % 2 === 0 && columnIndex !== puzzle.length - 1) {
                        cellElement.style.borderRight = '3px solid black';
                    }
                    if ((rowIndex + 1) % 2 === 0 && rowIndex !== puzzle.length - 1) {
                       cellElement.style.borderBottom = '3px solid black';
                    }
                    cellElement.dataset.row = rowIndex;
                    cellElement.dataset.col = columnIndex;

                    cellElement.addEventListener('touchstart', highlightCell);
                    cellElement.addEventListener('click', highlightCell);

                    container.appendChild(cellElement);
                    });
                });
            }

            //This function sets a desired value to the last cell touched on the grid
            function enterVal(num){
                var lastCell = document.querySelector(`.sudokuCell[data-row="${lastInteractedRow}"][data-col="${lastInteractedCol}"]`);
                lastCell.value = num;
            }

            createSudokuGrid(currPuzzle);
            //Button Function Mapping
            document.getElementById("submitButton")
                .addEventListener("click", checkPuzzle);
            document.getElementById("resetButton")
                .addEventListener("click", resetPuzzle);
            //Value button mapping
            document.getElementById("enter1")
                .addEventListener("click", () => enterVal(1));
            document.getElementById("enter2")
                .addEventListener("click", () => enterVal(2));
            document.getElementById("enter3")
                .addEventListener("click", () => enterVal(3));
            document.getElementById("enter4")
                .addEventListener("click", () => enterVal(4));
            document.querySelectorAll('.sudokuCell').forEach(element => {
                element.addEventListener('click', () => {
                    lastInteractedRow = element.dataset.row
                    lastInteractedCol = element.dataset.col

                    document.querySelectorAll('.sudokuCell').forEach(cell => cell.classList.remove('border-black-700'));
                    element.classList.add('border-black-700');
                });
            });
        });
    </script>

    <body class="bg-gradient-to-r from-blue-100 to-green-200 font-sans">
        <!--Add welcome modal here with app description and instructions (carosel of instructions)-->
        <section id= "header" class="container mx-auto p-6 md:py-10 md:px-8">
            <div class="flex items-center text-center justify-center">
                <h1 class="flex items-center justify-center font-bold text-4xl">PuzzlePop</h1>
            </div>
        </section>

        <section id= "easySudoku" class="container mx-auto py-6 px-4 sm:p-6 md:py-10 md:px-8">
            <div class="flex items-center justify-center">
            <div class="bg-white shadow rounded-lg p-6 flex flex-col items-center gap-4">
                <div id="easySudokuContainer"class="grid grid-cols-4 gap-px bg-gray-400 p-px"></div>
                <div class="text-center items-center">
                    <button id="enter1" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">1</button>
                    <button id="enter2" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">2</button>
                    <button id="enter3" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">3</button>
                    <button id="enter4" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">4</button>
                </div>
                <div class="text-center items-center">
                    <input type="text" readonly="true" id="feedback" class="p-2 w-full max-w-xs text-xl text-center text-rose-600"></input>
                </div>
                <div class="text-center items-center">
                    <a href="instagram://profile" id="clickContinue" class="p-2 w-full max-w-xs text-xl hidden">Click here to continue</a>
                </div>
            </div>
            </div>
        </section>

        <section id= "buttonBox" class="container mx-auto py-6 px-4 sm:p-6 md:py-10 md:px-8">
            <div class="flex items-center justify-center">
                <div class="bg-white shadow rounded-lg p-6 ">
                    <div id="buttonContainer" class="grid grid-cols-3 gap-4 justify-center">
                        <button id="submitButton" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Submit</button>
                        <button id="resetButton" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Reset</button>
                        <button command="show-modal" commandfor="dialog" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Help</button>
                    </div>
                </div>
            </div>
        </section>

        <el-dialog>
            <dialog id="dialog" aria-labelledby="dialog-title" class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
                <el-dialog-backdrop class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></el-dialog-backdrop>
                <div tabindex="0" class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
                <el-dialog-panel class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 id="dialog-title" class="text-base font-semibold text-gray-900">Basic Solving Tips</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500"><br><b>Single Possibility:</b> If a cell is the only one in its row, column, or region that can contain a particular number, then it must contain that number.
                        <br><b>Exclusion:</b> If a number is already present in a row or column, look to place that number in other regions in the same row or column where it is not present.
                        <br><b>Double Pairs:</b> If you find two cells in a row, column, or region that can only be two numbers (like 3 and 6), then exclude these two numbers from other cells in that area.
                        <br><b>Look for Grid Symmetry:</b> Sometimes, the arrangement of given numbers has a symmetrical pattern that can help predict the placement of other numbers.</p>
                        </div>
                        </div>
                    </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" command="close" commandfor="dialog" class="inline-flex w-full justify-center bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg px-3 py-2 text-sm shadow-xs sm:ml-3 sm:w-auto">Close</button>
                    </div>
                </el-dialog-panel>
                </div>
            </dialog>
        </el-dialog>

    </body>
</html>