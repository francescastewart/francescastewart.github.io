<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PuzzlePop</title>
        <script src="https://cdn.tailwindcss.com/"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
    </head>
    
    <style>
        .highlighted {
            background-color: #95e3f3 !important; /* light yellow highlight */
        }
    </style>

    <script>
        addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById("easySudokuContainer");
            
            //*********************START OF PUZZLES*********************
            //https://sudoku-puzzles.net/sudoku-4x4-medium/ reference for sudoku
            const puzzle1 = [
                [0, 0, 0, 4],
                [0, 0, 0, 0],
                [2, 0, 0, 3],
                [4, 0, 1, 2]
            ];

            const solvedPuzzle1 = [
                [1, 2, 3, 4],
                [3, 4, 2, 1],
                [2, 1, 4, 3],
                [4, 3, 1, 2]
            ];

            const puzzle2 = [
                [0, 0, 0, 3],
                [0, 4, 0, 0],
                [1, 0, 0, 4],
                [0, 0, 3, 0]
            ];

            const solvedPuzzle2 = [
                [2, 1, 4, 3],
                [3, 4, 1, 2],
                [1, 3, 2, 4],
                [4, 2, 3, 1]
            ];

            const puzzle3 = [
                [4, 0, 0, 3],
                [3, 1, 0, 0],
                [2, 0, 0,1],
                [0, 0, 2, 0]
            ];

            const solvedPuzzle3 = [
                [4, 2, 1, 3],
                [3, 1, 4, 2],
                [2, 4, 3,1],
                [1, 3, 2, 4]
            ];

            const puzzle4 = [
                [0, 0, 0, 0],
                [0, 0, 4, 3],
                [2, 0, 3,0],
                [0, 1, 0, 0]
            ];

            const solvedPuzzle4 = [
                [4, 3, 1, 2],
                [1, 2, 4, 3],
                [2, 4, 3,1],
                [3, 1, 2, 4]
            ];

            const puzzle5 = [
                [2,0,0,0],
                [3,4,0,0],
                [1,0,0,2],
                [4,0,1,0],
            ]

            const solvedPuzzle5 = [
                [2,1,3,4],
                [3,4,2,1],
                [1,3,4,2],
                [4,2,1,3],
            ]

            const puzzle6 = [
                [0,0,4,2],
                [0,0,3,0],
                [2,3,0,0],
                [0,0,2,0],
            ]

            const solvedPuzzle6 = [
                [3,1,4,2],
                [4,2,3,1],
                [2,3,1,4],
                [1,4,2,3],
            ]

            const puzzle7 = [
                [0, 0, 0, 0],
                [0, 0, 2, 4],
                [3, 2, 0, 0],
                [0, 0, 3, 2]
            ]

            const solvedPuzzle7 = [
                [2,4, 1, 3],
                [1, 3, 2, 4],
                [3, 2, 4, 1],
                [4, 1, 3, 2]
            ]

            const puzzle8 = [
                [0, 3, 0, 1],
                [1, 0, 0, 0],
                [4, 0, 1, 3],
                [0, 1, 0, 0]
            ]

            const solvedPuzzle8 = [
                [2, 3, 4, 1],
                [1, 4, 3, 2],
                [4, 2, 1, 3],
                [3, 1, 2, 4]
            ]

            const puzzle9 = [
                [0, 1, 0, 0],
                [0, 0, 0, 3],
                [4, 0, 0, 1],
                [0, 3, 2, 4]
            ]

            const solvedPuzzle9 = [
                [3, 1, 4, 2],
                [2, 4, 1, 3],
                [4, 2, 3, 1],
                [1, 3, 2, 4]
            ]

            const puzzle10 = [
                [0,0,0,2],
                [3,0,1,0],
                [0,3,0,0],
                [4,0,0,0]
            ]

            const solvedPuzzle10 = [
                [1,4,3,2],
                [3,2,1,4],
                [2,3,4,1],
                [4,1,2,3]
            ]

            
            //*********************END OF PUZZLES*********************
            const completePuzzle1 = {"puzzle":puzzle1, "solution":solvedPuzzle1}
            const completePuzzle2 = {"puzzle":puzzle2, "solution":solvedPuzzle2}
            const completePuzzle3 = {"puzzle":puzzle3, "solution":solvedPuzzle3}
            const completePuzzle4 = {"puzzle":puzzle4, "solution":solvedPuzzle4}
            const completePuzzle5 = {"puzzle":puzzle5, "solution":solvedPuzzle5}
            const completePuzzle6 = {"puzzle":puzzle6, "solution":solvedPuzzle6}
            const completePuzzle7 = {"puzzle":puzzle7, "solution":solvedPuzzle7}
            const completePuzzle8 = {"puzzle":puzzle8, "solution":solvedPuzzle8}
            const completePuzzle9 = {"puzzle":puzzle9, "solution":solvedPuzzle9}
            const completePuzzle10 = {"puzzle":puzzle10, "solution":solvedPuzzle10}
            const allPuzzles = [completePuzzle1, completePuzzle2, completePuzzle3, completePuzzle4, completePuzzle5, completePuzzle6, completePuzzle7, completePuzzle8, completePuzzle9, completePuzzle10]
            
            //Prevent user from getting the same puzzle consecutively by saving the puzzle # to local storage
            let lastPuzzle = localStorage.getItem("lastPuzzle");
            if(lastPuzzle != null){
                lastPuzzle = parseInt(lastPuzzle);
            }
            let random
            do{
                random = Math.floor(Math.random() * allPuzzles.length); 
            }
            while(random === lastPuzzle)
            localStorage.setItem("lastPuzzle", random);

            var currPuzzle =allPuzzles[random].puzzle; //make random
            var currSolution = allPuzzles[random].solution; //make random
            var lastInteractedRow = 0;
            var lastInteractedCol = 0;

            let currentHelpText =0;
            const helpText = [
                "PuzzlePop is here to help you on your screen time journey by taking small breaks in-between your scrolling activity. The goal is to complete one round of Sudoku.<br><br>To play 4x4 Sudoku, fill a 4x4 grid with the numbers 1,2,3, and 4 so that each number appears <b>exactly once</b> in each <b>row, each column, and each of the four 2x2 boxes.</b> Use the given numbers as clues, and deduce the placement of the missing numbers by cross-referencing what's already in each row, column, and box.<br><br>Page 1/3Â ",
                `<img src="src/sudoku-how-to-instructions.jpg" alt="Sudoku instructions" class="mx-auto rounded-lg shadow-md"><p><br><br>Page 2/3</p>`,
                "Here are some tips to help you solve:<br><br><b>Single Possibility:</b> If a cell is the only one in its row, column, or region that can contain a particular number, then it must contain that number.<br><b>Exclusion:</b> If a number is already present in a row or column, look to place that number in other regions in the same row or column where it is not present.<br><b>Look for Grid Symmetry:</b> Sometimes, the arrangement of given numbers has a symmetrical pattern that can help predict the placement of other numbers.<br><br>Page 3/3"
            ]

            //This function checks the current input and returns the user's input as a 2D array
            function getSudokuInput(){
                const inputs = container.querySelectorAll('input');
                var userPuzzle = [
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ];
                inputs.forEach(input=>{
                    var row = parseInt(input.dataset.row);
                    var col = parseInt(input.dataset.col);
                    var ans = parseInt(input.value)||0;
                    userPuzzle[row][col]=ans;
                });
                return userPuzzle;
            }

            //This function checks the current input to see if it is the same as the solved input
            function checkPuzzle(){
                const feedbackDiv = document.getElementById("feedback");
                var userPuzzle = getSudokuInput();
                if(JSON.stringify(userPuzzle) == JSON.stringify(currSolution)){
                    feedbackDiv.value = "Congrats!"
                    feedbackDiv.classList.remove("text-rose-600");
                    feedbackDiv.classList.add("text-green-700");
                    const continueDiv = document.getElementById("clickContinue");
                    continueDiv.classList.remove("hidden")
                }
                else{
                    feedbackDiv.value = "Incorrect, keep trying!";
                }
                    
            }
            
            //This function clears the board but maintains the solved puzzle
            function resetPuzzle(){
                const inputs = container.querySelectorAll('input');
                inputs.forEach(input=>{
                    var row = parseInt(input.dataset.row);
                    var col = parseInt(input.dataset.col);
                    input.value = (currPuzzle[row][col] !== 0 ? currPuzzle[row][col] : '');
                });
            }

            function highlightCell(e) {
                // remove highlight from all cells
                container.querySelectorAll('.highlighted').forEach(c => c.classList.remove('highlighted'));

                // highlight the tapped cell
                e.currentTarget.classList.add('highlighted');
            }
            function createSudokuGrid(puzzle) {
                container.innerHTML = '';

                puzzle.forEach((row, rowIndex) => {
                    row.forEach((cell, columnIndex) => {
                    const cellElement = document.createElement('input');
                    cellElement.type = 'text';
                    cellElement.maxLength = 1;
                    cellElement.value = (cell !== 0 ? cell : ''); //if the cell is 0 then print blank
                    cellElement.readOnly = true; 
                    cellElement.setAttribute("inputmode", "none");
                    cellElement.className = `
                        sudokuCell w-12 h-12 text-center text-lg font-bold
                        border border-gray-200 box-border focus:border-black-700 active:border-black-700
                        ${(rowIndex + columnIndex) % 2 === 0 ? 'bg-white' : 'bg-gray-200'}
                    `;
                    if(cell !== 0){
                        cellElement.className+='.presetSudokuCell'
                    }
                    if ((columnIndex + 1) % 2 === 0 && columnIndex !== puzzle.length - 1) {
                        cellElement.style.borderRight = '3px solid black';
                    }
                    if ((rowIndex + 1) % 2 === 0 && rowIndex !== puzzle.length - 1) {
                       cellElement.style.borderBottom = '3px solid black';
                    }
                    cellElement.dataset.row = rowIndex;
                    cellElement.dataset.col = columnIndex;

                    cellElement.addEventListener('touchstart', highlightCell);
                    cellElement.addEventListener('click', highlightCell);

                    container.appendChild(cellElement);
                    });
                });
            }

            //This function sets a desired value to the last cell touched on the grid
            function enterVal(num){
                var lastCell = document.querySelector(`.sudokuCell[data-row="${lastInteractedRow}"][data-col="${lastInteractedCol}"]`);
                if(!lastCell.classList.contains('.presetSudokuCell')){
                    lastCell.value = num;
                    lastCell.classList.add('text-gray-500')
                }
            }

            function goToNextHelpText(){
                currentHelpText = (currentHelpText +1)% helpText.length;
                document.getElementById("helpTextDiv").innerHTML = helpText[currentHelpText];
            }

            function getHelpModal(){
                document.getElementById("helpModal").classList.remove('hidden');
            }

            createSudokuGrid(currPuzzle);
            //Button Function Mapping
            document.getElementById("submitButton")
                .addEventListener("click", checkPuzzle);
            document.getElementById("resetButton")
                .addEventListener("click", resetPuzzle);
            document.getElementById("helpButton")
                .addEventListener("click", getHelpModal);
            document.getElementById("helpTextDiv").innerHTML = helpText[currentHelpText];
            document.getElementById("nextHelpText")
                .addEventListener("click", goToNextHelpText);
            //Value button mapping
            document.getElementById("enter1")
                .addEventListener("click", () => enterVal(1));
            document.getElementById("enter2")
                .addEventListener("click", () => enterVal(2));
            document.getElementById("enter3")
                .addEventListener("click", () => enterVal(3));
            document.getElementById("enter4")
                .addEventListener("click", () => enterVal(4));
            //Manually highlight the cell selected since issues with mobile
            document.querySelectorAll('.sudokuCell').forEach(element => {
                element.addEventListener('click', () => {
                    lastInteractedRow = element.dataset.row
                    lastInteractedCol = element.dataset.col

                    document.querySelectorAll('.sudokuCell').forEach(cell => cell.classList.remove('border-black-700'));
                    element.classList.add('border-black-700');
                });
            });
            
            //Help page on load
            const modal = document.getElementById("helpModal");
            modal.classList.remove("hidden");
            document.getElementById("closeModal").addEventListener("click", () => {
                modal.classList.add("hidden");
            });

        });
    </script>

    <body class="bg-cyan-100 font-sans">
        <section id= "header" class="container mx-auto p-6 md:py-10 md:px-8">
            <div class="flex items-center text-center justify-center">
                <h1 class="flex items-center justify-center font-bold text-4xl text-cyan-700">PuzzlePop</h1>
            </div>
            <div class="flex items-center text-center justify-center">
                <h3 class="flex items-center justify-center font-semibold text-xl text-cyan-700">Complete a round of Sudoku to return to your app!</h1>
            </div>
        </section>

        <section id= "easySudoku" class="container mx-auto py-4 px-4 sm:p-6 md:py-10 md:px-8">
            <div class="flex items-center justify-center">
            <div class="bg-white shadow rounded-lg p-6 flex flex-col items-center gap-4">
                <div id="easySudokuContainer"class="grid grid-cols-4 gap-px bg-gray-400 p-px"></div>
                <div class="text-center items-center">
                    <button id="enter1" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg">1</button>
                    <button id="enter2" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg">2</button>
                    <button id="enter3" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg">3</button>
                    <button id="enter4" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg">4</button>
                </div>
                <div class="text-center items-center">
                    <input type="text" readonly="true" id="feedback" class="p-2 w-full max-w-xs text-xl text-center text-rose-600"></input>
                </div>
                <div class="text-center items-center">
                    <a href="tiktok://" id="clickContinue" class="p-2 w-full max-w-xs text-xl hidden">Click here to continue</a>
                </div>
            </div>
            </div>
        </section>

        <section id= "buttonBox" class="container mx-auto py-6 px-4 sm:p-6 md:py-10 md:px-8">
            <div class="flex items-center justify-center">
                <div class="bg-white shadow rounded-lg p-6 ">
                    <div id="buttonContainer" class="grid grid-cols-3 gap-4 justify-center">
                        <button id="submitButton" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Submit</button>
                        <button id="resetButton" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Reset</button>
                        <button id= "helpButton" command="show-modal" commandfor="dialog" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Help</button>
                    </div>
                </div>
            </div>
        </section>

        <div id="helpModal">
            <div id="dialog" class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
                <backdrop class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></backdrop>
                
                <div tabindex="0" class="flex min-h-full items-end items-center justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                <h3 id="dialog-title" class="text-base font-semibold text-gray-900">How To Play</h3>
                                <div class="mt-2">
                                    <p id="helpTextDiv" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 flex flex-row-reverse sm:px-6 gap-2">
                        <button id = "closeModal" type="button" class="inline-flex w-full justify-center bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg px-3 py-2 text-sm shadow-xs sm:ml-3 sm:w-auto">Close</button>
                        <button id="nextHelpText" type="button" class="inline-flex w-full justify-center bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg px-3 py-2 text-sm shadow-xs sm:ml-3 sm:w-auto">Next</button>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </body>
</html>